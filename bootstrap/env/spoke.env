#!/usr/bin/env bash
###################################################################################################################################################
# SPOKE-Cluster configuration variables
#-------------------------------------------------------------------------------------------------------------------------------------------------#
                          export SPOKE_DOMAIN_NAME="${SPOKE_DOMAIN_NAME:-""}"
                          export SPOKE_CLUSTER_NAME="${SPOKE_CLUSTER_NAME:-"$$LOCAL_WORKING_DIR-$ENVIRONMENT"}"
#-------------------------------------------------------------------------------------------------------------------------------------------------#
                    export SPOKE_KUBERNETES_VERSION="${SPOKE_KUBERNETES_VERSION:-1.33}" # Kubernetes version for the spoke clusters
#-------------------------------------------------------------------------------------------------------------------------------------------------#
          export SPOKE_ADDONS_ENABLE_METRICS_SERVER="${SPOKE_ADDONS_ENABLE_METRICS_SERVER:-true}"           # ENABLE_SPOKE Metrics Server
        export SPOKE_ADDONS_ENABLE_EXTERNAL_SECRETS="${SPOKE_ADDONS_ENABLE_EXTERNAL_SECRETS:-true}"         # ENABLE_SPOKE External Secrets
            export SPOKE_ADDONS_ENABLE_EXTERNAL_DNS="${SPOKE_ADDONS_ENABLE_EXTERNAL_DNS:-true}"             # ENABLE_SPOKE External DNS
          export SPOKE_ADDONS_ENABLE_ADOT_COLLECTOR="${SPOKE_ADDONS_ENABLE_ADOT_COLLECTOR:-true}"           # ENABLE_SPOKE AWS Distro for OpenTelemetry Collector
           export SPOKE_ADDONS_ENABLE_CW_PROMETHEUS="${SPOKE_ADDONS_ENABLE_CW_PROMETHEUS:-true}"            # ENABLE_SPOKE CloudWatch Prometheus
                 export SPOKE_ADDONS_ENABLE_KYVERNO="${SPOKE_ADDONS_ENABLE_KYVERNO:-true}"                  # ENABLE_SPOKE Kyverno
        export SPOKE_ADDONS_ENABLE_KYVERNO_POLICIES="${SPOKE_ADDONS_ENABLE_KYVERNO_POLICIES:-true}"         # ENABLE_SPOKE Kyverno Policies
 export SPOKE_ADDONS_ENABLE_KYVERNO_POLICY_REPORTER="${SPOKE_ADDONS_ENABLE_KYVERNO_POLICY_REPORTER:-true}"  # ENABLE_SPOKE Kyverno Policy Reporter
      export SPOKE_ADDONS_ENABLE_CNI_METRICS_HELPER="${SPOKE_ADDONS_ENABLE_CNI_METRICS_HELPER:-false}"      # ENABLE_SPOKE CNI Metrics Helper
export SPOKE_ADDONS_ENABLE_PROMETHEUS_NODE_EXPORTER="${SPOKE_ADDONS_ENABLE_PROMETHEUS_NODE_EXPORTER:-true}" # ENABLE_SPOKE Prometheus Node Exporter
      export SPOKE_ADDONS_ENABLE_KUBE_STATE_METRICS="${SPOKE_ADDONS_ENABLE_KUBE_STATE_METRICS:-true}"       # ENABLE_SPOKE Kube State Metrics
  export SPOKE_ADDONS_ENABLE_OPENTELEMETRY_OPERATOR="${SPOKE_ADDONS_ENABLE_OPENTELEMETRY_OPERATOR:-true}"   # ENABLE_SPOKE OpenTelemetry Operator
            export SPOKE_ADDONS_ENABLE_CERT_MANAGER="${SPOKE_ADDONS_ENABLE_CERT_MANAGER:-true}"             # ENABLE_SPOKE Cert Manager
                 export SPOKE_ADDONS_ENABLE_ACK_IAM="${SPOKE_ADDONS_ENABLE_ACK_IAM:-true}"                  # ENABLE_SPOKE ACK IAM
                 export SPOKE_ADDONS_ENABLE_ACK_EKS="${SPOKE_ADDONS_ENABLE_ACK_EKS:-true}"                  # ENABLE_SPOKE ACK EKS
                 export SPOKE_ADDONS_ENABLE_ACK_EFS="${SPOKE_ADDONS_ENABLE_ACK_EFS:-true}"                  # ENABLE_SPOKE ACK EFS
      export SPOKE_ADDONS_ENABLE_AWS_EFS_CSI_DRIVER="${SPOKE_ADDONS_ENABLE_AWS_EFS_CSI_DRIVER:-true}"       # ENABLE_SPOKE AWS EFS CSI Driver
#-------------------------------------------------------------------------------------------------------------------------------------------------#
if [ "$CREATE_SPOKE" -eq 1 ]; then
    export SPOKE_CLUSTER_INFO='
  '"$WORKLOAD_CLUSTER_ID"': 
    managementAccountId: "'"$HUB_ACCOUNT_ID"'"
    accountId:           "'"$SPOKE_ACCOUNT_ID"'"
    k8sVersion:          "'"$SPOKE_KUBERNETES_VERSION"'"
    domainName:          "'"$SPOKE_DOMAIN_NAME"'"
    workloads:           "true"
    gitops:
      addonsRepoUrl:        "'"https://$GITOPS_ADDONS_GITHUB_URL/$GITOPS_ADDONS_ORG_NAME/$GITOPS_ADDONS_REPO_NAME"'"
      fleetRepoUrl:         "'"https://$GITOPS_FLEET_GITHUB_URL/$GITOPS_FLEET_ORG_NAME/$GITOPS_FLEET_REPO_NAME"'"
      platformRepoUrl:      "'"https://$GITOPS_PLATFORM_GITHUB_URL/$GITOPS_PLATFORM_ORG_NAME/$GITOPS_PLATFORM_REPO_NAME"'"
      workloadRepoUrl:      "'"https://$GITOPS_WORKLOAD_GITHUB_URL/$GITOPS_WORKLOAD_ORG_NAME/$GITOPS_WORKLOAD_REPO_NAME"'"
      addonsRepoRevision:   "'"$GITOPS_ADDONS_REPO_REVISION"'"
      fleetRepoRevision:    "'"$GITOPS_FLEET_REPO_REVISION"'"
      platformRepoRevision: "'"$GITOPS_PLATFORM_REPO_REVISION"'"
      workloadRepoRevision: "'"$GITOPS_WORKLOAD_REPO_REVISION"'"
    addons:
      enable_metrics_server:           '$SPOKE_ADDONS_ENABLE_METRICS_SERVER'
      enable_external_secrets:         '$SPOKE_ADDONS_ENABLE_EXTERNAL_SECRETS'
      enable_external_dns:             '$SPOKE_ADDONS_ENABLE_EXTERNAL_DNS'
      enable_adot_collector:           '$SPOKE_ADDONS_ENABLE_ADOT_COLLECTOR'
      enable_cw_prometheus:            '$SPOKE_ADDONS_ENABLE_CW_PROMETHEUS'
      enable_kyverno:                  '$SPOKE_ADDONS_ENABLE_KYVERNO'
      enable_kyverno_policies:         '$SPOKE_ADDONS_ENABLE_KYVERNO_POLICIES'
      enable_kyverno_policy_reporter:  '$SPOKE_ADDONS_ENABLE_KYVERNO_POLICY_REPORTER'
      enable_cni_metrics_helper:       '$SPOKE_ADDONS_ENABLE_CNI_METRICS_HELPER'
      enable_prometheus_node_exporter: '$SPOKE_ADDONS_ENABLE_PROMETHEUS_NODE_EXPORTER'
      enable_kube_state_metrics:       '$SPOKE_ADDONS_ENABLE_KUBE_STATE_METRICS'
      enable_opentelemetry_operator:   '$SPOKE_ADDONS_ENABLE_OPENTELEMETRY_OPERATOR'
      enable_cert_manager:             '$SPOKE_ADDONS_ENABLE_CERT_MANAGER'
      enable_ack_iam:                  '$SPOKE_ADDONS_ENABLE_ACK_IAM'
      enable_ack_eks:                  '$SPOKE_ADDONS_ENABLE_ACK_EKS'
      enable_ack_efs:                  '$SPOKE_ADDONS_ENABLE_ACK_EFS'
      enable_aws_efs_csi_driver:       '$SPOKE_ADDONS_ENABLE_AWS_EFS_CSI_DRIVER''
fi
###################################################################################################################################################
###################################################################################################################################################
# End of file
###################################################################################################################################################

