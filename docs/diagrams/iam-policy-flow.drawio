<mxfile host="app.diagrams.net">
  <diagram name="IAM Policy Flow" id="iam-policy-flow">
    <mxGraphModel dx="1434" dy="796" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="IAM Policy Flow: Three Scenarios" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="40" width="450" height="40" as="geometry"/>
        </mxCell>

        <!-- Scenario 1: Hub-Internal -->
        <mxCell id="scenario1-box" value="Scenario 1: Hub-Internal (Same Account)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="120" width="320" height="240" as="geometry"/>
        </mxCell>

        <mxCell id="s1-iam-dir" value="iam/gen3/hub/&#xa;acks/s3/" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="110" y="160" width="130" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="s1-policy" value="s3-internal.json&#xa;(Hub permissions)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="110" y="230" width="130" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="s1-pod-identity" value="Pod Identity&#xa;ack-s3-controller&#xa;(Hub Account)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="260" y="160" width="120" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="s1-result" value="✓ Direct attachment&#xa;✓ No assume role" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="110" y="300" width="250" height="40" as="geometry"/>
        </mxCell>

        <!-- Arrow S1 -->
        <mxCell id="arrow-s1-1" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="175" y="210" as="sourcePoint"/>
            <mxPoint x="175" y="230" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-s1-2" value="attach" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#009900;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="240" y="250" as="sourcePoint"/>
            <mxPoint x="260" y="220" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Scenario 2: Cross-Account -->
        <mxCell id="scenario2-box" value="Scenario 2: Cross-Account (Different Accounts)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="80" y="400" width="680" height="240" as="geometry"/>
        </mxCell>

        <!-- Hub Side -->
        <mxCell id="s2-hub-box" value="Hub Account" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b1ddf0;strokeColor=#10739e;verticalAlign=top;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="110" y="440" width="270" height="180" as="geometry"/>
        </mxCell>

        <mxCell id="s2-iam-dir" value="iam/gen3/spoke1/&#xa;acks/s3/" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="130" y="480" width="120" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="s2-cross-policy" value="s3-cross-account.json&#xa;(AssumeRole spoke)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="130" y="550" width="120" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="s2-pod-identity" value="Pod Identity&#xa;ack-s3-controller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="270" y="480" width="90" height="60" as="geometry"/>
        </mxCell>

        <!-- Spoke Side -->
        <mxCell id="s2-spoke-box" value="Spoke Account" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad7ac;strokeColor=#b46504;verticalAlign=top;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="430" y="440" width="310" height="180" as="geometry"/>
        </mxCell>

        <mxCell id="s2-spoke-role" value="IAM Role&#xa;gen3-spoke1-s3-ack" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="460" y="480" width="130" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="s2-spoke-policy" value="s3-internal.json&#xa;(Spoke S3 permissions)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="460" y="560" width="130" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="s2-trust" value="Trust Policy:&#xa;arn:aws:iam::HUB:role/...&#xa;(Hub pod identity)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="610" y="480" width="110" height="70" as="geometry"/>
        </mxCell>

        <!-- Arrows S2 -->
        <mxCell id="arrow-s2-1" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="530" as="sourcePoint"/>
            <mxPoint x="190" y="550" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-s2-2" value="attach" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#009900;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="250" y="570" as="sourcePoint"/>
            <mxPoint x="270" y="520" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-s2-3" value="AssumeRole" style="endArrow=classic;html=1;strokeWidth=3;strokeColor=#FF0000;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="360" y="510" as="sourcePoint"/>
            <mxPoint x="460" y="510" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-s2-4" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="525" y="540" as="sourcePoint"/>
            <mxPoint x="525" y="560" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-s2-5" value="trusts" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#0066CC;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="590" y="515" as="sourcePoint"/>
            <mxPoint x="610" y="515" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Scenario 3: Override -->
        <mxCell id="scenario3-box" value="Scenario 3: Role ARN Override (Existing Roles)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="810" y="120" width="330" height="240" as="geometry"/>
        </mxCell>

        <mxCell id="s3-override" value="spoke_role_arns = {&#xa;  s3 = &quot;arn:aws:iam::...&quot;&#xa;  dynamodb = &quot;arn:...&quot;&#xa;}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;fontFamily=Courier New;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="840" y="160" width="270" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="s3-pod-identity" value="Pod Identity&#xa;ack-s3-controller" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="840" y="250" width="120" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="s3-external-role" value="External Role&#xa;(Pre-existing)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="990" y="250" width="120" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="s3-result" value="✓ No role creation&#xa;✓ No policy creation&#xa;✓ Use provided ARNs" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="840" y="320" width="270" height="30" as="geometry"/>
        </mxCell>

        <!-- Arrow S3 -->
        <mxCell id="arrow-s3-1" value="provides ARN" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#FF6600;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="975" y="210" as="sourcePoint"/>
            <mxPoint x="900" y="250" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-s3-2" value="assumes" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#0066CC;dashed=1;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="960" y="280" as="sourcePoint"/>
            <mxPoint x="990" y="280" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="Legend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="810" y="400" width="330" height="240" as="geometry"/>
        </mxCell>

        <mxCell id="legend-policy" value="IAM Policy File" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="830" y="440" width="100" height="30" as="geometry"/>
        </mxCell>

        <mxCell id="legend-pod" value="Pod Identity" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="830" y="480" width="100" height="30" as="geometry"/>
        </mxCell>

        <mxCell id="legend-iam-dir" value="IAM Directory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="830" y="520" width="100" height="30" as="geometry"/>
        </mxCell>

        <mxCell id="legend-cross" value="Cross-Account&#xa;Policy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="830" y="560" width="100" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="legend-arrow1" value="AssumeRole" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#FF0000;dashed=1;fontSize=10" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1000" y="450" as="sourcePoint"/>
            <mxPoint x="1090" y="450" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="legend-arrow2" value="Trust Policy" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#0066CC;dashed=1;fontSize=10" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1000" y="490" as="sourcePoint"/>
            <mxPoint x="1090" y="490" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="legend-arrow3" value="Attach Policy" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#009900;fontSize=10" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1000" y="530" as="sourcePoint"/>
            <mxPoint x="1090" y="530" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="legend-arrow4" value="Override ARN" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#FF6600;fontSize=10" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1000" y="570" as="sourcePoint"/>
            <mxPoint x="1090" y="570" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
